# Identity and Access Management (IAM)


## IAM Users
IAM Users are an identity for managing *long-term* AWS access for an *individual* human, application, or service account.

### Terminology

1. **Principal**: A human or application that needs to access resources behind IAM
2. **Identity**: An IAM user governed by IAM policies for accessing resources
3. **Authenticated Identity**: A principal that has authenticated with IAM that it is allowed to use the IAM identity.

### Request Flow

1. Authentication: A principal will request access to IAM resources through an IAM identity. The principal will authenticate against the IAM identity to prove it can use the identity.

The principal can use (1) username and password or (2) access keys for authentication. The latter is used by services. The principal is known as an authenticated identity after it successfully authenticates.

2. Authorization: The IAM identity will run the request against the IAM resources. If the IAM policy authorizes the identity to take the action, the request will run.

## Amazon Resource Name (ARN)
ARNs uniquely identity each AWS resource (e.g., individual EC2 resources). Some ARN formats are below. For global services, such as S3, the region and account are omitted.

`arn: partition:service:region:account-id:resource-id`
`arn: partition:service:region:account-id:resource-type/resource-id`
`arn: partition:service:region:account-id:resource-type:resource-id`

**Note** (*exam point*): ARNs for resources that contain objects, such as S3, are distinct from the ARNs for those objects. This difference is important when creating identity policies (e.g., covering access to both a bucket and its objects).

Example:
- `arn:aws:s3:::catgifs` refers to the bucket. A statement covering the ability to modify the bucket's policy would require this designation.
- `arn:aws:s3:::catgifs/*` refers to the objects in the bucket. A statement covering the ability to access objects in the bucket needs this bucket.


### IAM User Limits (*exam point*)
- Accounts are limited to 5000 IAM users (identities).
    - If over 5000 users are needed or an internet-scale application is involved, IAM roles or identity federation are needed.
- An IAM user can be a member of 10 groups

## IAM Groups

IAM Groups are containers for IAM Users to make administration easier. You cannot log into an IAM Group; they have no credentials (*exam point*).

### Benefits

1. Administration: Groups can be used to manage large groups of users. Users can be a member of multiple groups.
2. Policies: Groups can have in-line and managed policies attached to them.

### IAM Group Limits

- Accounts are limited to 300 IAM Groups.
- Groups cannot be nested under other Groups.
- No limit on the number of IAM Users in one group (all 5000 users can be in one group).
- There is no built-in "all users" group (*exam point*), but you can create one.

### IAM Policies

- **IAM Groups are not an identity**.
- IAM Policies can be created at the resource level that reference IAM Users and IAM Roles. However, since IAM *Groups* are **NOT** an identity, they cannot be referenced as a principal in these policies (*exam point*).

Example: You can create an "all users" IAM group and grant it access under a resource IAM policy.

## IAM Roles
IAM Roles is an identity for managing multiple principals (humans or services) using the same identity. IAM Roles are **assumed** for a *short* period of time, the principal **becomes** that role. 

### IAM Role Policies
IAM Roles have two types of policies: (1) trust policies and (2) permissions policies. 

1. **Trust Policy**: Trust policies govern the idenities that can assume the IAM Role. These identities can be IAM Users, services (e.g., EC2), identities in other AWS accounts, anonymous users, or third-party services (e.g., Facebook).

- If an identity assumes an IAM Role, it will receive **temporary security credentials**.
- Temporary security credentials are short-term time-limited access keys; they can be renewed by re-assuming the IAM Role. 
- Temporary credentials are generated by AWS's Secure Token Service (STS). The operation is `sts:AssumeRole`.


2. **Permissions Policy**: Temporary security credentials can access resources governed by their permissions policies.
- Every action using a temporary credential is checked against the permissions policies.
- If a permission policy is changed, the permissions of the temporary credentials also changes.

### Resource Policies
IAM Roles are true identities so they can be referenced in resource policies.

### AWS Organizations
IAM Roles can be used accross AWS Accounts. AWS Accounts can be grouped together under an AWS Organization. IAM Roles are used within AWS Organizations to allow principals to log into one location and access multiple AWS Accounts.

### Use Cases

1. **Service Accounts**: Creating a role that gives an AWS Service the relevant permissions to perform actions in an AWS Account.

Example: Providing an AWS Lambda function the ability to take certain actions within an AWS Account. You can create a "Lambda Execution Role" that (1) has a trust policy that trusts the Lambda Service and (2) has a permissions policy providing access to relevant account resources. When the function runs, it uses STS to retrieve temporary security credentials, which it then uses to take actions within the AWS Account. This approach is preferred because (1) it avoids hardcoding access keys in the Lambda function and (2) allows multiple Lambda functions to run simultaneously.

2. **Emergency Scenarios**: IAM Roles are useful for "break glass" scenarios because it (1) allows users to explicitly access higher privileged actions and (2) is logged.

3. **Existing External IdP/SSO**: Corporate environments typically have their own IdP or SSO. There are two challenges in this scenario: (1) external accounts cannot be used directly to access AWS resources and (2) > 5000 users frequently exist in companies. Creating an IAM Role allows users managed by the IdP to access AWS resources and remain below the 5000 IAM User limit. 

4. **IAM User Limit**: Consumer applications have millions of users that need access to AWS resources. An IAM Role can be used to provide those users access through **web identity federation**. Identity providers such as Google, Facebook, and Twitter provide web identities that allows their users to sign into other apps. These web identities can be linked to an IAM Role to provide them access to AWS resources.

5. **Cross Account Access**: Assume there are two AWS accounts: one owned by a company and one owned by a partner. An IAM Role can be created in one account that can provide access to the other account. For example, an IAM Role in the partner account can be created to give the company access to a S3 bucket in the partner account. If the company uploads data to the S3 bucket, the partner will also have access to the data.

## IAM Service-Linked Role
IAM Service-Linked Roles are IAM Roles linked to a specific AWS service (e.g., EC2) with **predefined permissions**. The permissions allows a service to take actions with respect to **other AWS services**.

The key difference is that a service-linked role can **NOT** be deleted until it is not longer required.

Note: For IAM policies, the resource for specifying the service is case-sensitive and the format is not consistent between different services.

Role Separation and Role Passing
From a business process perspective, you may need to institute role separation where one group of users has the ability to take certain actions while another group is allowed to take a different set of actions. For example, one IAM Role might only have the ability to create roles while another IAM Role only has the ability to use them. 

The `iam:ListRole` and `iam:PassRole` Actions allow a user (1) to use a service with the service-linked role's permissions by "passing" the role into the service (2) but not the ability to create or modify the service-linked-role.

Example: A user might use a role that has the ability to create AWS resources. The user can pass that role into Cloudformation to create a stack.